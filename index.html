<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover,user-scalable=no,maximum-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="PiÅ¡ta">
  <link rel="apple-touch-icon" href="icons/icon-180x180.png">
  <link rel="apple-touch-icon" sizes="192x192" href="icons/icon-192x192.png">
  <link rel="apple-touch-icon" sizes="512x512" href="icons/icon-512x512.png">
  <meta name="theme-color" content="#06090f">
  <link rel="manifest" href="manifest.json">
  <link rel="stylesheet" href="styles.css">
  <title>Imigrant PiÅ¡ta</title>
</head>
<body>
<div id="app">
  <!-- Particle Background -->
  <canvas id="particles"></canvas>

  <!-- TITLE SCREEN -->
  <div id="title-screen" class="screen active">
    <div class="title-icon">ğŸ‘·</div>
    <div class="title-name">IMIGRANT<br>PIÅ TA</div>
    <div class="title-subtitle">NelegÃ¡lnÃ­ PrÃ¡ce</div>
    <div class="title-tagline">Pracuj. SchovÃ¡vej se. PÅ™eÅ¾ij.<br>KaÅ¾dÃ½ den je boj o pÅ™eÅ¾itÃ­.</div>
    <div class="title-stats">
      <div class="title-stat"><span class="title-stat-value" id="title-highscore">0â‚¬</span><span class="title-stat-label">Rekord</span></div>
      <div class="title-stat"><span class="title-stat-value" id="title-bestday">0</span><span class="title-stat-label">NejdelÅ¡Ã­</span></div>
      <div class="title-stat"><span class="title-stat-value" id="title-achievements">0/12</span><span class="title-stat-label">Achievem.</span></div>
    </div>
    <div class="title-buttons">
      <button class="btn btn-primary btn-block" onclick="startGame()">â–¶ ZAÄŒÃT HRU</button>
      <button class="btn btn-secondary btn-block btn-sm" onclick="showHowTo()">ğŸ“– Jak hrÃ¡t</button>
    </div>
  </div>

  <!-- GAME SCREEN -->
  <div id="game-screen" class="screen">
    <div class="game-hud">
      <div class="hud-item"><span class="hud-label">PenÃ­ze</span><span class="hud-value money" id="hud-money">50â‚¬</span></div>
      <div class="hud-item"><span class="hud-label">Den</span><span class="hud-value day" id="hud-day">Den 1</span></div>
      <div class="hud-item"><span class="hud-label">Riziko</span><span class="hud-value risk" id="hud-risk">0%</span></div>
      <div class="hud-item"><span class="hud-label">Level</span><span class="hud-value level" id="hud-level">Lv.1</span></div>
    </div>
    <div class="xp-bar-container">
      <div class="xp-bar"><div class="xp-fill" id="xp-fill" style="width:0%"></div></div>
      <div class="xp-text" id="xp-text">0/50 XP</div>
    </div>
    <div class="day-bar">
      <span class="day-title" id="day-title">â˜€ï¸ Ãškol</span>
      <span class="day-weather" id="day-weather">â˜€ï¸ Jasno</span>
    </div>
    <div class="tab-bar">
      <button class="tab-btn active" data-tab="game" onclick="switchTab('game')"><span class="tab-icon">âš”ï¸</span>Hra</button>
      <button class="tab-btn" data-tab="shop" onclick="switchTab('shop')"><span class="tab-icon">ğŸ›’</span>Obchod</button>
      <button class="tab-btn" data-tab="skills" onclick="switchTab('skills')"><span class="tab-icon">ğŸ¯</span>Skilly</button>
      <button class="tab-btn" data-tab="stats" onclick="switchTab('stats')"><span class="tab-icon">ğŸ“Š</span>Stats</button>
    </div>

    <!-- TAB: Game -->
    <div class="tab-content" id="tab-game" style="display:flex">
      <div class="alert-bar" id="alert-bar"><span class="alert-icon">ğŸš¨</span><span class="alert-text" id="alert-text"></span><span class="alert-level" id="alert-level"></span></div>
      <div class="immune-banner" id="immune-banner">ğŸ›¡ï¸ Imunita: <strong id="immune-days">0</strong> dnÃ­</div>

      <div class="task-card">
        <div class="task-header"><span class="task-type" id="task-type">Stavba</span><span class="task-reward" id="task-reward">+120â‚¬</span></div>
        <div class="task-name" id="task-name">Ãškol</div>
        <div class="task-desc" id="task-desc">Popis</div>
        <div class="progress-container">
          <div class="progress-header"><span class="progress-label">Postup</span><span class="progress-value" id="progress-value">0/3</span></div>
          <div class="progress-track"><div class="progress-fill" id="progress-fill" style="width:0%"></div></div>
        </div>
      </div>

      <div style="display:flex;gap:10px;align-items:flex-start;">
        <div style="flex:1">
          <div class="meters">
            <div class="meter"><div class="meter-header"><span class="meter-label">âš¡ Energie</span><span class="meter-value" id="meter-energy-value">100%</span></div><div class="meter-track"><div class="meter-fill energy" id="meter-energy-fill" style="width:100%"></div></div></div>
            <div class="meter"><div class="meter-header"><span class="meter-label">ğŸ‘ï¸ PodezÅ™enÃ­</span><span class="meter-value" id="meter-suspicion-value">0%</span></div><div class="meter-track"><div class="meter-fill suspicion" id="meter-suspicion-fill" style="width:0%"></div></div></div>
            <div class="meter"><div class="meter-header"><span class="meter-label">ğŸ’ª Stamina</span><span class="meter-value" id="meter-stamina-value">80%</span></div><div class="meter-track"><div class="meter-fill stamina" id="meter-stamina-fill" style="width:80%"></div></div></div>
            <div class="meter"><div class="meter-header"><span class="meter-label">ğŸ¥· Stealth</span><span class="meter-value" id="meter-stealth-value">50%</span></div><div class="meter-track"><div class="meter-fill stealth" id="meter-stealth-fill" style="width:50%"></div></div></div>
          </div>
        </div>
        <div class="minimap-wrapper">
          <canvas id="minimap" width="82" height="82"></canvas>
          <div class="minimap-legend">
            <div class="legend-item"><div class="legend-dot yellow"></div>Ty</div>
            <div class="legend-item"><div class="legend-dot red"></div>Patroly</div>
          </div>
        </div>
      </div>

      <div class="black-market" id="black-market">
        <div class="bm-header"><span class="bm-badge">ğŸ•¶ï¸ ÄŒernÃ½ trh</span></div>
        <div class="bm-content">
          <div class="bm-icon" id="bm-icon">ğŸ“•</div>
          <div class="bm-info"><div class="bm-name" id="bm-name">NabÃ­dka</div><div class="bm-desc" id="bm-desc">Popis</div></div>
          <button class="bm-buy" id="btn-bm-buy" onclick="haptic();buyBM()"><span id="bm-price">300â‚¬</span></button>
        </div>
      </div>

      <div class="actions-header"><span class="progress-label" id="actions-left">Akce: 3/3</span></div>
      <div class="actions-grid">
        <button class="action-btn work" id="btn-work" onclick="haptic();doWork()"><span class="action-icon">ğŸ”¨</span>Pracovat</button>
        <button class="action-btn hide" id="btn-hide" onclick="haptic();doHide()"><span class="action-icon">ğŸ™ˆ</span>Schovat se</button>
        <button class="action-btn bribe" id="btn-bribe" onclick="haptic();doBribe()"><span class="action-icon">ğŸ’¸</span>Uplatit</button>
        <button class="action-btn rest" id="btn-rest" onclick="haptic();doRest()"><span class="action-icon">ğŸ˜´</span>OdpoÄinek</button>
        <button class="action-btn firstaid" id="btn-firstaid" onclick="haptic();useFirstAid()" style="display:none"><span class="action-icon">ğŸ©¹</span>LÃ©kÃ¡rniÄka</button>
      </div>
      <button class="btn btn-success btn-block" id="btn-endday" onclick="haptic();endDay()" style="display:none">ğŸŒ™ UkonÄit den</button>
      <div class="event-feed" id="event-feed"></div>
    </div>

    <!-- TAB: Shop -->
    <div class="tab-content" id="tab-shop" style="display:none">
      <div style="display:flex;justify-content:space-between;align-items:center;">
        <span class="progress-label">Obchod</span>
        <span class="progress-label" style="color:var(--neon-green)" id="shop-money-display"></span>
      </div>
      <div id="shop-list"></div>
    </div>

    <!-- TAB: Skills -->
    <div class="tab-content" id="tab-skills" style="display:none">
      <div class="skills-header">
        <span class="progress-label">Dovednosti</span>
        <span class="sp-display">SP: <span id="skill-points-display">0</span></span>
      </div>
      <div id="skills-list"></div>
    </div>

    <!-- TAB: Stats -->
    <div class="tab-content" id="tab-stats" style="display:none">
      <div id="stats-content"></div>
    </div>
  </div>

  <!-- GAME OVER -->
  <div id="gameover-screen" class="screen">
    <div class="gameover-icon">ğŸš”</div>
    <div class="gameover-title">KONEC HRY</div>
    <div class="gameover-reason" id="gameover-reason">Deportace!</div>
    <div class="gameover-stats">
      <div class="gameover-stat"><span class="gameover-stat-value" id="gameover-days">1</span><span class="gameover-stat-label">DnÃ­</span></div>
      <div class="gameover-stat"><span class="gameover-stat-value" id="gameover-earned">0â‚¬</span><span class="gameover-stat-label">VydÄ›lÃ¡no</span></div>
      <div class="gameover-stat"><span class="gameover-stat-value" id="gameover-final">0â‚¬</span><span class="gameover-stat-label">ZÅ¯statek</span></div>
      <div class="gameover-stat"><span class="gameover-stat-value" id="gameover-level">1</span><span class="gameover-stat-label">Level</span></div>
      <div class="gameover-stat"><span class="gameover-stat-value" id="gameover-tasks">0</span><span class="gameover-stat-label">ÃškolÅ¯</span></div>
      <div class="gameover-stat"><span class="gameover-stat-value" id="gameover-escapes">0</span><span class="gameover-stat-label">ÃšnikÅ¯</span></div>
    </div>
    <div class="gameover-buttons">
      <button class="btn btn-primary btn-block" onclick="startGame()">ğŸ”„ HrÃ¡t znovu</button>
      <button class="btn btn-secondary btn-block" onclick="showScreen('title-screen');updateTitle();">ğŸ  Menu</button>
    </div>
  </div>

  <!-- HOW TO PLAY -->
  <div id="howto-overlay" class="modal-overlay">
    <div class="modal">
      <div class="modal-icon">ğŸ“–</div>
      <div class="modal-title">Jak hrÃ¡t</div>
      <div class="howto-content">
        <b>ğŸ”¨ Pracovat</b> â€” SplÅˆ Ãºkol a vydÄ›lej. ZvyÅ¡uje riziko.<br><br>
        <b>ğŸ™ˆ Schovat se</b> â€” SniÅ¾ podezÅ™enÃ­. VyÅ¡Å¡Ã­ stealth = lepÅ¡Ã­.<br><br>
        <b>ğŸ’¸ Uplatit</b> â€” ZaplaÅ¥ za snÃ­Å¾enÃ­ podezÅ™enÃ­.<br><br>
        <b>ğŸ˜´ OdpoÄinek</b> â€” Obnov energii a staminu.<br><br>
        <b>ğŸ›’ Obchod</b> â€” Helma, boty, faleÅ¡nÃ© dokladyâ€¦<br><br>
        <b>ğŸ¯ Skilly</b> â€” Za levely skill pointy â†’ vylepÅ¡enÃ­.<br><br>
        <b>ğŸ•¶ï¸ ÄŒernÃ½ trh</b> â€” VzÃ¡cnÃ© nabÃ­dky kaÅ¾dÃ© 3 dny.<br><br>
        <b>ğŸ—ºï¸ Mapa</b> â€” Kup a vidÃ­Å¡ patroly v reÃ¡lnÃ©m Äase.<br><br>
        <b>âš ï¸</b> PodezÅ™enÃ­ 100% = deportace!
      </div>
      <div class="modal-actions">
        <button class="btn btn-primary btn-block" onclick="document.getElementById('howto-overlay').classList.remove('active')">RozumÃ­m!</button>
      </div>
    </div>
  </div>

  <!-- EVENT MODAL -->
  <div id="modal-overlay" class="modal-overlay">
    <div class="modal">
      <div class="modal-icon" id="modal-icon">ğŸš¨</div>
      <div class="modal-title" id="modal-title">Event</div>
      <div class="modal-text" id="modal-text">Text</div>
      <div class="modal-effects" id="modal-effects"></div>
      <div class="modal-actions" id="modal-actions"></div>
    </div>
  </div>

  <div class="patrol-warning" id="patrol-warning"></div>
  <div class="scanner" id="scanner"></div>
</div>

<script src="app.js"></script>
<script>
// Force clear old service workers and caches
if('serviceWorker' in navigator) {
  navigator.serviceWorker.getRegistrations().then(regs => {
    regs.forEach(r => r.unregister());
  });
  caches.keys().then(keys => keys.forEach(k => caches.delete(k)));
  navigator.serviceWorker.register('sw.js').catch(()=>{});
}
</script>
</body>
</html>
